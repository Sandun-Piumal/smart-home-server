<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Login System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Arial', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            padding: 20px;
        }
        .container { 
            background: white; 
            padding: 2rem; 
            border-radius: 15px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.2); 
            width: 100%; 
            max-width: 450px;
        }
        .logo { text-align: center; margin-bottom: 2rem; color: #333; }
        .logo h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .tabs { display: flex; margin-bottom: 1.5rem; background: #f8f9fa; border-radius: 10px; padding: 5px; }
        .tab { flex: 1; padding: 12px; text-align: center; background: transparent; cursor: pointer; border: none; border-radius: 8px; font-size: 16px; }
        .tab.active { background: #007bff; color: white; }
        .form { display: none; }
        .form.active { display: block; }
        .form-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input { width: 100%; padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px; }
        input:focus { border-color: #007bff; outline: none; }
        .btn { width: 100%; padding: 14px; background: #007bff; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 10px; }
        .btn:hover { background: #0056b3; }
        .message { margin-top: 1rem; padding: 10px; border-radius: 5px; text-align: center; display: none; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
        .form-row { display: flex; gap: 15px; }
        .form-row .form-group { flex: 1; }
        .system-info { background: #e7f3ff; padding: 10px; border-radius: 5px; margin-top: 1rem; text-align: center; font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <h1>üîê Auth System</h1>
            <p>Secure Login & Registration</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('login')">Login</button>
            <button class="tab" onclick="showTab('signup')">Sign Up</button>
        </div>

        <!-- Login Form -->
        <div id="loginForm" class="form active">
            <h2 style="text-align: center; margin-bottom: 1.5rem; color: #333;">Login</h2>
            <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" placeholder="your@email.com" required>
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" placeholder="Your password" required>
            </div>
            <button class="btn" onclick="login()">Login</button>
            <div id="loginMessage" class="message"></div>
        </div>

        <!-- Signup Form -->
        <div id="signupForm" class="form">
            <h2 style="text-align: center; margin-bottom: 1.5rem; color: #333;">Create Account</h2>
            <div class="form-group">
                <label for="fullName">Full Name</label>
                <input type="text" id="fullName" placeholder="John Doe" required>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="phone">Phone</label>
                    <input type="tel" id="phone" placeholder="0712345678" required>
                </div>
                <div class="form-group">
                    <label for="birthday">Birthday</label>
                    <input type="date" id="birthday" required>
                </div>
            </div>
            <div class="form-group">
                <label for="signupEmail">Email</label>
                <input type="email" id="signupEmail" placeholder="your@email.com" required>
            </div>
            <div class="form-group">
                <label for="signupPassword">Password</label>
                <input type="password" id="signupPassword" placeholder="Min 6 characters" required>
            </div>
            <div class="form-group">
                <label for="confirmPassword">Confirm Password</label>
                <input type="password" id="confirmPassword" placeholder="Confirm password" required>
            </div>
            <button class="btn" onclick="signup()">Create Account</button>
            <div id="signupMessage" class="message"></div>
        </div>

        <div class="system-info">
            <p><strong>Test Accounts:</strong><br>
            Admin: admin@example.com / admin123<br>
            User: user@example.com / 123456</p>
        </div>
    </div>

    <script>
        // Simple password hashing (FIXED)
        function hashPassword(password) {
            return btoa(unescape(encodeURIComponent(password)));
        }

        // Initialize system
        function initializeSystem() {
            if (!localStorage.getItem('users')) {
                const defaultUsers = [
                    {
                        id: 'admin_1',
                        personal: { 
                            fullName: 'System Admin', 
                            phone: '0712345678', 
                            birthday: '1990-01-01', 
                            age: 33, 
                            email: 'admin@example.com' 
                        },
                        auth: { 
                            password: hashPassword('admin123'), 
                            role: 'admin', 
                            status: 'active' 
                        },
                        timestamps: { 
                            createdAt: new Date().toISOString(), 
                            lastLogin: null 
                        }
                    },
                    {
                        id: 'user_1', 
                        personal: { 
                            fullName: 'Test User', 
                            phone: '0776543210', 
                            birthday: '1995-05-15', 
                            age: 28, 
                            email: 'user@example.com' 
                        },
                        auth: { 
                            password: hashPassword('123456'), 
                            role: 'user', 
                            status: 'active' 
                        },
                        timestamps: { 
                            createdAt: new Date().toISOString(), 
                            lastLogin: null 
                        }
                    }
                ];
                localStorage.setItem('users', JSON.stringify(defaultUsers));
                console.log('System initialized with default users');
            }
        }

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.form').forEach(form => form.classList.remove('active'));
            
            // Activate clicked tab
            const tabs = document.querySelectorAll('.tab');
            const forms = document.querySelectorAll('.form');
            
            if (tabName === 'login') {
                tabs[0].classList.add('active');
                forms[0].classList.add('active');
            } else {
                tabs[1].classList.add('active');
                forms[1].classList.add('active');
            }
        }

        // Show message
        function showMessage(type, message, formType) {
            const messageDiv = document.getElementById(formType + 'Message');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            
            // Auto hide after 3 seconds
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }

        // Login function (FIXED)
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showMessage('error', 'Please fill all fields', 'login');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users')) || [];
            console.log('All users:', users);
            
            // Find user with exact email match
            const user = users.find(u => u.personal.email === email);
            console.log('Found user:', user);

            if (!user) {
                showMessage('error', 'Invalid email or password', 'login');
                return;
            }

            // Check password (FIXED)
            const hashedInputPassword = hashPassword(password);
            console.log('Input password hash:', hashedInputPassword);
            console.log('Stored password hash:', user.auth.password);

            if (user.auth.password !== hashedInputPassword) {
                showMessage('error', 'Invalid email or password', 'login');
                return;
            }

            // Update last login
            user.timestamps.lastLogin = new Date().toISOString();
            localStorage.setItem('users', JSON.stringify(users));
            
            // Store current user
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            showMessage('success', 'Login successful! Redirecting...', 'login');
            setTimeout(() => {
                window.location.href = 'dashboard.html';
            }, 1000);
        }

        // Signup function (FIXED)
        function signup() {
            const fullName = document.getElementById('fullName').value;
            const phone = document.getElementById('phone').value;
            const birthday = document.getElementById('birthday').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // Validation
            if (!fullName || !phone || !birthday || !email || !password || !confirmPassword) {
                showMessage('error', 'Please fill all fields', 'signup');
                return;
            }

            if (password !== confirmPassword) {
                showMessage('error', 'Passwords do not match', 'signup');
                return;
            }

            if (password.length < 6) {
                showMessage('error', 'Password must be 6+ characters', 'signup');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users')) || [];
            
            // Check existing user
            if (users.find(u => u.personal.email === email)) {
                showMessage('error', 'Email already exists', 'signup');
                return;
            }

            // Calculate age
            const age = new Date().getFullYear() - new Date(birthday).getFullYear();

            // Create user
            const newUser = {
                id: 'user_' + Date.now(),
                personal: { 
                    fullName, 
                    phone, 
                    birthday, 
                    age, 
                    email 
                },
                auth: { 
                    password: hashPassword(password), 
                    role: 'user', 
                    status: 'active' 
                },
                timestamps: { 
                    createdAt: new Date().toISOString(), 
                    lastLogin: null 
                }
            };

            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            showMessage('success', 'Account created successfully!', 'signup');
            
            // Clear form and switch to login
            setTimeout(() => {
                document.getElementById('fullName').value = '';
                document.getElementById('phone').value = '';
                document.getElementById('birthday').value = '';
                document.getElementById('signupEmail').value = '';
                document.getElementById('signupPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                showTab('login');
            }, 2000);
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeSystem();
            
            // Set date limits
            const maxDate = new Date();
            maxDate.setFullYear(maxDate.getFullYear() - 13);
            document.getElementById('birthday').max = maxDate.toISOString().split('T')[0];
            
            const minDate = new Date();
            minDate.setFullYear(minDate.getFullYear() - 100);
            document.getElementById('birthday').min = minDate.toISOString().split('T')[0];

            console.log('System ready. Test accounts created.');
        });
    </script>
</body>
</html>
